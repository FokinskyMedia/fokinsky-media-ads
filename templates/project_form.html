{% extends 'base.html' %}
{% block content %}
<h2>Создать проект</h2>
<form method="post">
  {{ form.hidden_tag() }}
  
  <div class="mb-3">
    {{ form.name.label(class_='form-label') }}
    {{ form.name(class_='form-control') }}
    {% if form.name.errors %}
      <div class="text-danger">{{ form.name.errors[0] }}</div>
    {% endif %}
  </div>

  <!-- ДОБАВЛЕН ВЫБОР РЕКЛАМОДАТЕЛЯ -->
  <div class="mb-3">
    <label class="form-label">Рекламодатель</label>
    <select name="advertiser_id" class="form-control" required onchange="toggleAdvertiserFields()">
      <option value="">-- Выберите рекламодателя --</option>
      <option value="0">-- Новый рекламодатель --</option>  <!-- ✅ ДОБАВЛЕНО -->
      {% for advertiser in advertisers %}
        <option value="{{ advertiser.id }}">
          {{ advertiser.name }}
        </option>
      {% endfor %}
    </select>
  </div>

  <!-- ✅ ДОБАВЛЕНЫ ПОЛЯ ДЛЯ НОВОГО РЕКЛАМОДАТЕЛЯ -->
  <div id="newAdvertiserFields" style="display: none;" class="border p-3 mb-3 rounded">
    <h6>Новый рекламодатель</h6>
    <div class="mb-2">
      <label class="form-label">Название компании</label>
      <input type="text" name="new_advertiser_name" class="form-control" placeholder="Введите название" required>
    </div>
    <div class="mb-2">
      <label class="form-label">Telegram</label>
      <input type="text" name="new_advertiser_telegram" class="form-control" placeholder="Необязательно">
    </div>
  </div>

  <!-- ВЫБОР МЕСЯЦА ТОЛЬКО ЕСЛИ НЕ ПЕРЕДАН ИЗ URL -->
  {% if show_month_select %}
  <div class="mb-3">
    <label class="form-label">Месяц</label>
    <select name="month_id" class="form-control" required>
      <option value="">-- Выберите месяц --</option>
      {% for month in months %}
        <option value="{{ month.id }}" {% if month.id == preselected_month_id|int %}selected{% endif %}>
          {{ month.name }}
        </option>
      {% endfor %}
    </select>
  </div>
  {% else %}
    <!-- Скрытое поле с month_id -->
    <input type="hidden" name="month_id" value="{{ preselected_month_id }}">
    <div class="alert alert-info">
      Проект будет создан в месяце: 
      <strong>
        {% for month in months %}
          {% if month.id == preselected_month_id|int %}{{ month.name }}{% endif %}
        {% endfor %}
      </strong>
    </div>
  {% endif %}
  
  <div class="mb-3">
    {{ form.description.label(class_='form-label') }}
    {{ form.description(class_='form-control', rows='4', placeholder='Описание проекта') }}
  </div>
  
  <button class="btn btn-primary">Создать проект</button>
  {% if preselected_month_id %}
    <a href="/month/{{ preselected_month_id }}" class="btn btn-secondary">Отмена</a>
  {% else %}
    <a href="/projects" class="btn btn-secondary">Отмена</a>
  {% endif %}
</form>

<script>
function toggleAdvertiserFields() {
  const advertiserSelect = document.querySelector('[name="advertiser_id"]');
  const newAdvertiserFields = document.getElementById('newAdvertiserFields');
  newAdvertiserFields.style.display = advertiserSelect.value === '0' ? 'block' : 'none';
}

// Инициализация при загрузке
document.addEventListener('DOMContentLoaded', function() {
  toggleAdvertiserFields();
});
</script>
{% endblock %}