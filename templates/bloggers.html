{% extends 'base.html' %}
{% block content %}
<h2>–ë–ª–æ–≥–µ—Ä—ã 
    <a href="/blogger/add" class="btn btn-sm btn-success">–î–æ–±–∞–≤–∏—Ç—å</a>
</h2>

<!-- –ü–û–ò–°–ö –ë–õ–û–ì–ï–†–û–í -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get" action="/bloggers" class="row g-2">
            <div class="col-md-8">
                <input type="text" name="search" class="form-control" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –±–ª–æ–≥–µ—Ä–∞..." value="{{ search_query }}">
            </div>
            <div class="col-md-2">
                <select name="platform" class="form-control">
                    <option value="">–í—Å–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</option>
                    <option value="tiktok" {% if platform_filter == 'tiktok' %}selected{% endif %}>TikTok</option>
                    <option value="tg" {% if platform_filter == 'tg' %}selected{% endif %}>Telegram</option>
                    <option value="insta" {% if platform_filter == 'insta' %}selected{% endif %}>Instagram</option>
                    <option value="youtube" {% if platform_filter == 'youtube' %}selected{% endif %}>YouTube</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">–ù–∞–π—Ç–∏</button>
            </div>
        </form>
        {% if search_query or platform_filter %}
            <div class="mt-2">
                <small class="text-muted">
                    –ù–∞–π–¥–µ–Ω–æ: {{ bloggers.total }} –±–ª–æ–≥–µ—Ä–æ–≤
                    {% if search_query %} –ø–æ –∑–∞–ø—Ä–æ—Å—É "{{ search_query }}"{% endif %}
                    {% if platform_filter %} –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ {{ platform_filter }}{% endif %}
                </small>
                <a href="/bloggers" class="btn btn-sm btn-outline-secondary ms-2">–°–±—Ä–æ—Å–∏—Ç—å</a>
            </div>
        {% endif %}
    </div>
</div>

<!-- –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ü–ê–ì–ò–ù–ê–¶–ò–ò -->
<div class="alert alert-info d-flex justify-content-between align-items-center py-2 mb-3">
    <small>
        üìä –ü–æ–∫–∞–∑–∞–Ω–æ: <strong>{{ bloggers.items|length }}</strong> –∏–∑ <strong>{{ bloggers.total }}</strong> –±–ª–æ–≥–µ—Ä–æ–≤
    </small>
    {% if bloggers.pages > 1 %}
    <small>
        üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞: <strong>{{ bloggers.page }}</strong> –∏–∑ <strong>{{ bloggers.pages }}</strong>
    </small>
    {% endif %}
</div>

<table class="table table-striped table-sm">
  <thead>
    <tr>
      <th>–ò–º—è</th>
      <th>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</th>
      <th>–ö–æ–Ω—Ç–µ–Ω—Ç</th>
      <th>–ö–æ–Ω—Ç–∞–∫—Ç—ã</th>
      <th>–†–ö–ù</th>
      <th>–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
  </thead>
  <tbody>
    {% for b in bloggers.items %}
      <tr>
        <td>{{ b.name }}</td>
        <td>
          <span class="badge bg-secondary">{{ b.platform }}</span>
        </td>
        <td>
          {% if b.link %}
            <a href="{{ b.link }}" target="_blank" class="btn btn-sm btn-outline-primary" title="–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç">
              <i class="fas fa-external-link-alt"></i>
            </a>
          {% else %}
            <span class="text-muted">---</span>
          {% endif %}
        </td>
        <td>
          {% if b.contact_link %}
            <a href="{{ b.contact_link }}" target="_blank" class="btn btn-sm btn-outline-success" title="–ö–æ–Ω—Ç–∞–∫—Ç –±–ª–æ–≥–µ—Ä–∞">
              <i class="fab fa-telegram"></i> –ö–æ–Ω—Ç–∞–∫—Ç
            </a>
          {% elif b.telegram %}
            <a href="https://t.me/{{ b.telegram }}" target="_blank" class="text-decoration-none">
              <small>@{{ b.telegram }}</small>
            </a>
          {% else %}
            <span class="text-muted">---</span>
          {% endif %}
        </td>
        <td>
          {% if b.rkn_info %}
            <a href="{{ b.rkn_info }}" target="_blank" class="badge bg-warning" title="–†–ö–ù –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è">–†–ö–ù</a>
          {% else %}
            <span class="text-muted">---</span>
          {% endif %}
        </td>
        <td>
          <a href="/blogger/{{ b.id }}/edit" class="btn btn-sm btn-primary">–†–µ–¥.</a>
          <form action="/blogger/{{ b.id }}/delete" method="post" style="display:inline;">
            <button class="btn btn-sm btn-danger" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å?');">X</button>
          </form>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{# –ü–ê–ì–ò–ù–ê–¶–ò–Ø –î–õ–Ø –ë–õ–û–ì–ï–†–û–í #}
{% if bloggers.pages > 1 %}
<div class="mt-4">
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if bloggers.has_prev %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('bloggers', page=bloggers.prev_num, search=search_query, platform=platform_filter) }}">‚Üê –ù–∞–∑–∞–¥</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link">‚Üê –ù–∞–∑–∞–¥</span>
            </li>
            {% endif %}
            
            {% for page_num in bloggers.iter_pages(left_edge=2, left_current=2, right_current=3, right_edge=2) %}
                {% if page_num %}
                    {% if page_num == bloggers.page %}
                    <li class="page-item active">
                        <span class="page-link">{{ page_num }}</span>
                    </li>
                    {% else %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('bloggers', page=page_num, search=search_query, platform=platform_filter) }}">{{ page_num }}</a>
                    </li>
                    {% endif %}
                {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">...</span>
                    </li>
                {% endif %}
            {% endfor %}
            
            {% if bloggers.has_next %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('bloggers', page=bloggers.next_num, search=search_query, platform=platform_filter) }}">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link">–í–ø–µ—Ä–µ–¥ ‚Üí</span>
            </li>
            {% endif %}
        </ul>
    </nav>
</div>
{% endif %}
{% endblock %}